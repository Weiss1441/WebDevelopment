<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TaskBoard</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>

<nav>
  <a href="/">Home</a>
  <a href="/tasks">Tasks</a>
  <a href="/login" id="loginLink">Login</a>
  <button id="logoutBtn" style="display:none; margin-left:10px;">Logout</button>
</nav>

<div class="container">
  <h1>TaskBoard</h1>
  <p class="description">
    TaskBoard is a simple web application for managing tasks.
    Users can create, update and delete tasks after logging in.
  </p>

  <h2>Features</h2>
  <ul>
    <li>Session-based authentication</li>
    <li>Protected CRUD operations</li>
    <li>MongoDB Atlas database</li>
    <li>Deployed production application</li>
  </ul>
</div>

<script>
  const loginLink = document.getElementById('loginLink');
  const logoutBtn = document.getElementById('logoutBtn');

  async function fetchJson(url, options) {
    const res = await fetch(url, options);
    const text = await res.text();
    let data = null;
    try { data = text ? JSON.parse(text) : null; } catch { data = null; }
    return { res, data };
  }

  function setAuthUI(authenticated) {
    loginLink.style.display = authenticated ? 'none' : 'inline';
    logoutBtn.style.display = authenticated ? 'inline-block' : 'none';
  }

  async function checkAuth() {
    const { res, data } = await fetchJson('/api/auth/me');
    if (res.ok && data?.authenticated) setAuthUI(true);
    else setAuthUI(false);
  }

  logoutBtn.addEventListener('click', async () => {
    await fetchJson('/api/auth/logout', { method: 'POST' });
    setAuthUI(false);
    window.location.href = '/login';
  });

  document.addEventListener('DOMContentLoaded', checkAuth);
</script>

</body>
</html>
